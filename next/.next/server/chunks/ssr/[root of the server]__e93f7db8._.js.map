{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 81, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hu/Downloads/Compressed/luuppi-next-main4/luuppi-next-main/next/src/libs/db/prisma.ts"],"sourcesContent":["/* eslint-disable no-unused-vars */\nimport { PrismaClient } from '@prisma/client';\n\ndeclare global {\n  var prisma: PrismaClient | undefined;\n}\n\nconst prisma = global.prisma || new PrismaClient();\n\nif (process.env.NODE_ENV === 'development') global.prisma = prisma;\n\nexport default prisma;\n"],"names":[],"mappings":"AAAA,iCAAiC;;;AACjC;;AAMA,MAAM,SAAS,OAAO,MAAM,IAAI,IAAI,6HAAA,CAAA,eAAY;AAEhD,wCAA4C,OAAO,MAAM,GAAG;uCAE7C","debugId":null}},
    {"offset": {"line": 95, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hu/Downloads/Compressed/luuppi-next-main4/luuppi-next-main/next/src/auth.ts"],"sourcesContent":["import jwt from 'jsonwebtoken';\nimport NextAuth from 'next-auth';\nimport AzureB2C from 'next-auth/providers/azure-ad-b2c';\nimport 'server-only';\nimport prisma from './libs/db/prisma';\nimport { logger } from './libs/utils/logger';\n\nexport const {\n  handlers: { GET, POST },\n  auth,\n  signIn,\n  signOut,\n} = NextAuth({\n  providers: [\n    AzureB2C({\n      clientId: process.env.AZURE_P_CLIENT_ID,\n      clientSecret: process.env.AZURE_P_CLIENT_SECRET,\n      authorization: {\n        url: `https://${process.env.AZURE_TENANT_ID}.ciamlogin.com/${process.env.AZURE_TENANT_ID}/oauth2/v2.0/authorize`,\n        params: {\n          code_challenge_method: undefined,\n          code_challenge: undefined,\n        },\n      },\n      issuer: `https://${process.env.AZURE_TENANT_ID}.ciamlogin.com/${process.env.AZURE_TENANT_ID}/v2.0`,\n      token: {\n        url: `https://${process.env.AZURE_TENANT_ID}.ciamlogin.com/${process.env.AZURE_TENANT_ID}/oauth2/v2.0/token`,\n        grant_type: 'authorization_code',\n      },\n    }),\n  ],\n  pages: {\n    error: '/auth/error',\n  },\n  trustHost: true,\n  secret: process.env.NEXTAUTH_SECRET,\n  callbacks: {\n    async session({ session, token }) {\n      if (token) {\n        session.user.entraUserUuid = token.id as string;\n        session.user.isLuuppiHato = token.isLuuppiHato as boolean;\n        session.user.isLuuppiMember = token.isLuuppiMember as boolean;\n        session.user.name = token.username as string;\n      }\n\n      // Forces user to sign in again if token version is outdated.\n      // Useful for forcing users to sign in again after updating token version if\n      // major changes have been made to the token structure.\n      if (!token.version || token.version !== process.env.TOKEN_VERSION) {\n        throw new Error('Token version mismatch');\n      }\n\n      // This should never happen, but just in case\n      if (!session.user.entraUserUuid) {\n        throw new Error('Malformed token');\n      }\n\n      return session;\n    },\n    async jwt({ token, account }) {\n      if (account) {\n        const idToken = account.id_token;\n        if (!idToken) return token;\n        let decoded: null | { email: string; oid: string } = null;\n        try {\n          decoded = jwt.decode(idToken) as { email: string; oid: string };\n        } catch (e) {\n          logger.error('Error decoding JWT', e);\n        }\n        if (!decoded) return token;\n        token.email = decoded.email;\n        token.id = decoded.oid;\n\n        // Update user to local database\n        const localUser = await prisma.user.upsert({\n          where: {\n            entraUserUuid: decoded.oid,\n          },\n          update: {\n            email: decoded.email,\n            roles: {\n              connectOrCreate: {\n                where: {\n                  strapiRoleUuid_entraUserUuid: {\n                    entraUserUuid: decoded.oid,\n                    strapiRoleUuid: process.env.NEXT_PUBLIC_NO_ROLE_ID!,\n                  },\n                },\n                create: {\n                  role: {\n                    connect: {\n                      strapiRoleUuid: process.env.NEXT_PUBLIC_NO_ROLE_ID!,\n                    },\n                  },\n                },\n              },\n            },\n          },\n          create: {\n            entraUserUuid: decoded.oid,\n            email: decoded.email,\n            roles: {\n              create: {\n                role: {\n                  connect: {\n                    strapiRoleUuid: process.env.NEXT_PUBLIC_NO_ROLE_ID!,\n                  },\n                },\n              },\n            },\n          },\n          include: {\n            roles: {\n              include: {\n                role: true,\n              },\n              where: {\n                OR: [\n                  {\n                    expiresAt: {\n                      gte: new Date(),\n                    },\n                  },\n                  {\n                    expiresAt: null,\n                  },\n                ],\n              },\n            },\n          },\n        });\n\n        const hasRole = (roleUuid: string) =>\n          localUser.roles.some((role) => role.role.strapiRoleUuid === roleUuid);\n\n        token.isLuuppiHato = hasRole(process.env.NEXT_PUBLIC_LUUPPI_HATO_ID!);\n        token.isLuuppiMember = hasRole(\n          process.env.NEXT_PUBLIC_LUUPPI_MEMBER_ID!,\n        );\n        token.username = localUser.username;\n        token.version = process.env.TOKEN_VERSION;\n      }\n      return token;\n    },\n  },\n});\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 247, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hu/Downloads/Compressed/luuppi-next-main4/luuppi-next-main/next/src/actions/auth.ts"],"sourcesContent":["'use server';\nimport { signIn as authSignIn, signOut as authSignOut } from '@/auth';\nimport { redirect } from 'next/navigation';\n\nexport const signIn = async () => authSignIn('azure-ad-b2c');\nexport const signOut = async () => {\n  await authSignOut({ redirect: false });\n  const logoutUrl = `https://${process.env.AZURE_TENANT_ID}.ciamlogin.com/${process.env.AZURE_TENANT_ID}/oauth2/logout?client_id=${process.env.AZURE_P_CLIENT_ID}&post_logout_redirect_uri=${process.env.NEXT_PUBLIC_BASE_URL}`;\n  redirect(logoutUrl);\n};\n"],"names":[],"mappings":";;;;;;AACA;AACA;AAAA;;;;;;AAEO,MAAM,uCAAI,GAAJ,SAAS,UAAY,CAAA,GAAA,2GAAA,CAAA,SAAU,AAAD,EAAE;AACtC,MAAM,uCAAK,GAAL,UAAU;IACrB,MAAM,CAAA,GAAA,2GAAA,CAAA,UAAW,AAAD,EAAE;QAAE,UAAU;IAAM;IACpC,MAAM,YAAY,CAAC,QAAQ,EAAE,QAAQ,GAAG,CAAC,eAAe,CAAC,eAAe,EAAE,QAAQ,GAAG,CAAC,eAAe,CAAC,yBAAyB,EAAE,QAAQ,GAAG,CAAC,iBAAiB,CAAC,0BAA0B,6DAAoC;IAC7N,CAAA,GAAA,qLAAA,CAAA,WAAQ,AAAD,EAAE;AACX;;;IALa;IACA;;AADA,+OAAA;AACA,+OAAA","debugId":null}},
    {"offset": {"line": 346, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hu/Downloads/Compressed/luuppi-next-main4/luuppi-next-main/next/src/libs/db/redis.ts"],"sourcesContent":["import Redis from 'ioredis';\nimport { logger } from '../utils/logger';\n\nconst redisClient = new Redis({\n  host: process.env.REDIS_HOST,\n  port: process.env.REDIS_PORT ? parseInt(process.env.REDIS_PORT) : 6379,\n  lazyConnect: true,\n});\n\nredisClient.on('error', (err) => logger.error('Redis error', err));\n\nlogger.info('Connecting to Redis');\nredisClient.connect();\n\nexport { redisClient };\n"],"names":[],"mappings":";;;AAAA;AACA;;;AAEA,MAAM,cAAc,IAAI,yIAAA,CAAA,UAAK,CAAC;IAC5B,MAAM,QAAQ,GAAG,CAAC,UAAU;IAC5B,MAAM,QAAQ,GAAG,CAAC,UAAU,GAAG,SAAS,QAAQ,GAAG,CAAC,UAAU,IAAI;IAClE,aAAa;AACf;AAEA,YAAY,EAAE,CAAC,SAAS,CAAC,MAAQ,8HAAA,CAAA,SAAM,CAAC,KAAK,CAAC,eAAe;AAE7D,8HAAA,CAAA,SAAM,CAAC,IAAI,CAAC;AACZ,YAAY,OAAO","debugId":null}},
    {"offset": {"line": 368, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hu/Downloads/Compressed/luuppi-next-main4/luuppi-next-main/next/src/actions/reservation-create.ts"],"sourcesContent":["'use server';\nimport { auth } from '@/auth';\nimport { getDictionary } from '@/dictionaries';\nimport prisma from '@/libs/db/prisma';\nimport { redisClient } from '@/libs/db/redis';\nimport { getStrapiData } from '@/libs/strapi/get-strapi-data';\nimport { logger } from '@/libs/utils/logger';\nimport { SupportedLanguage } from '@/models/locale';\nimport { APIResponse } from '@/types/types';\nimport { revalidateTag } from 'next/cache';\n\nconst options = {\n  noRoleId: process.env.NEXT_PUBLIC_NO_ROLE_ID!,\n};\n\nexport async function reservationCreate(\n  eventId: number,\n  amount: number,\n  lang: SupportedLanguage,\n  selectedQuota: string,\n  userProvidedTargetedRole: string | undefined,\n) {\n  const dictionary = await getDictionary(lang);\n  const session = await auth();\n\n  if (!session?.user) {\n    return {\n      message: dictionary.api.unauthorized,\n      isError: true,\n    };\n  }\n\n  // User provided targeted role cannot be trusted (can be manipulated by user), but this\n  // prevents unnecessary database queries most of the time\n  if (\n    userProvidedTargetedRole &&\n    typeof userProvidedTargetedRole === 'string'\n  ) {\n    // Check if the event is sold out for the user's role\n    const isSoldOut = await redisClient.get(\n      `event-sold-out:${eventId}:${userProvidedTargetedRole}`,\n    );\n    if (isSoldOut) {\n      logger.info(\n        `Cache hit: Event ${eventId} is sold out for role ${userProvidedTargetedRole}`,\n      );\n      return {\n        message: dictionary.api.sold_out,\n        isError: true,\n      };\n    }\n  }\n\n  if (!amount || isNaN(amount) || amount < 1) {\n    return {\n      message: dictionary.api.invalid_amount,\n      isError: true,\n    };\n  }\n\n  if (!eventId || isNaN(eventId) || eventId < 1) {\n    return {\n      message: dictionary.api.invalid_event,\n      isError: true,\n    };\n  }\n\n  const strapiUrl = `/api/events/${eventId}?populate=Registration.TicketTypes.Role&populate=Registration.RoleToGive`;\n  const strapiEvent = await getStrapiData<APIResponse<'api::event.event'>>(\n    lang,\n    strapiUrl,\n    [`event-${eventId}`],\n    true,\n  );\n\n  if (!strapiEvent) {\n    return {\n      message: dictionary.api.invalid_event,\n      isError: true,\n    };\n  }\n\n  // Preload user data outside transaction\n  const localUser = await prisma.user.findUnique({\n    where: {\n      entraUserUuid: session.user.entraUserUuid,\n    },\n    include: {\n      roles: {\n        select: {\n          role: {\n            select: {\n              strapiRoleUuid: true,\n            },\n          },\n          expiresAt: true,\n        },\n        where: {\n          OR: [{ expiresAt: { gte: new Date() } }, { expiresAt: null }],\n        },\n      },\n    },\n  });\n\n  if (!localUser) {\n    return {\n      message: dictionary.api.unauthorized,\n      isError: true,\n    };\n  }\n\n  const strapiRoleUuids =\n    localUser.roles.map((role) => role.role.strapiRoleUuid) ?? [];\n  const ticketTypes = strapiEvent.data.attributes.Registration?.TicketTypes;\n\n  const eventRolesWithWeights =\n    ticketTypes?.map((ticketType) => ({\n      strapiRoleUuid: ticketType.Role?.data?.attributes?.RoleId,\n      weight: ticketType.Weight,\n    })) ?? [];\n\n  const hasDefaultRoleWeight = eventRolesWithWeights.find(\n    (role) => role.strapiRoleUuid === options.noRoleId!,\n  );\n\n  const targetedRole = strapiRoleUuids.reduce(\n    (acc, strapiRoleUuid) => {\n      const roleWeight =\n        eventRolesWithWeights.find(\n          (role) => role.strapiRoleUuid === strapiRoleUuid,\n        )?.weight ?? 0;\n      return roleWeight > acc.weight\n        ? { strapiRoleUuid, weight: roleWeight }\n        : acc;\n    },\n    {\n      strapiRoleUuid: options.noRoleId!,\n      weight: hasDefaultRoleWeight?.weight ?? 0,\n    },\n  );\n\n  // This might happen if somehow user is sending stale data\n  if (targetedRole.strapiRoleUuid !== selectedQuota) {\n    return {\n      message: dictionary.api.server_error,\n      isError: true,\n      reloadCache: true,\n    };\n  }\n\n  const ownQuota = ticketTypes?.find(\n    (type) =>\n      type.Role?.data?.attributes?.RoleId === targetedRole.strapiRoleUuid,\n  );\n\n  // Validate that the user has a role that can reserve tickets\n  if (!ownQuota) {\n    return {\n      message: dictionary.api.unauthorized,\n      isError: true,\n    };\n  }\n\n  // Validate that the registration is still open\n  if (new Date(ownQuota.RegistrationEndsAt) < new Date()) {\n    return {\n      message: dictionary.api.registration_closed,\n      isError: true,\n    };\n  }\n\n  // Validate that registration is open\n  if (new Date(ownQuota.RegistrationStartsAt) > new Date()) {\n    return {\n      message: dictionary.api.registration_not_open,\n      isError: true,\n    };\n  }\n\n  const strapiRoleUuid = targetedRole.strapiRoleUuid;\n  const entraUserUuid = localUser.entraUserUuid;\n\n  const result = await prisma\n    .$transaction(async (prisma) => {\n      await prisma.$executeRaw`LOCK TABLE \"EventRegistration\" IN ACCESS EXCLUSIVE MODE`;\n\n      const [eventRegistrations, currentUserReservations] = await Promise.all([\n        prisma.eventRegistration.findMany({\n          where: {\n            eventId,\n            deletedAt: null,\n            OR: [\n              { reservedUntil: { gte: new Date() } },\n              { paymentCompleted: true },\n              {\n                paymentCompleted: false,\n                payments: { some: { status: 'PENDING' } },\n              },\n            ],\n          },\n          select: {\n            purchaseRole: {\n              select: {\n                strapiRoleUuid: true,\n              },\n            },\n          },\n        }),\n        prisma.eventRegistration.count({\n          where: {\n            eventId,\n            entraUserUuid: localUser.entraUserUuid,\n            purchaseRole: {\n              strapiRoleUuid: targetedRole.strapiRoleUuid,\n            },\n            deletedAt: null,\n            OR: [\n              { reservedUntil: { gte: new Date() } },\n              { paymentCompleted: true },\n              {\n                paymentCompleted: false,\n                payments: { some: { status: 'PENDING' } },\n              },\n            ],\n          },\n        }),\n      ]);\n\n      const totalRegistrationWithRole = eventRegistrations.filter(\n        (registration) =>\n          registration.purchaseRole.strapiRoleUuid ===\n          targetedRole.strapiRoleUuid,\n      ).length;\n\n      // Validate that the event is not sold out for the user's role\n      if (totalRegistrationWithRole >= ownQuota.TicketsTotal) {\n        return {\n          message: dictionary.api.sold_out,\n          isError: true,\n        };\n      }\n\n      const ticketsAvailable =\n        ownQuota.TicketsTotal - totalRegistrationWithRole;\n      const ticketsAllowedToBuy = ownQuota.TicketsAllowedToBuy;\n\n      // Validate that the user has not already reserved the maximum amount of tickets\n      if (currentUserReservations >= ticketsAllowedToBuy) {\n        return {\n          message: dictionary.api.maximum_tickets_reached,\n          isError: true,\n        };\n      }\n\n      // Validate per user limit still allows the user to reserve the amount\n      const canReserveAmount =\n        amount + currentUserReservations <= ticketsAllowedToBuy;\n      if (!canReserveAmount) {\n        return {\n          message: dictionary.api.no_room_own_limit,\n          isError: true,\n        };\n      }\n\n      // Validate that there are still enough tickets available\n      const isAvailable = amount <= ticketsAvailable;\n      if (!isAvailable) {\n        return {\n          message: dictionary.api.not_enough_tickets,\n          isError: true,\n        };\n      }\n\n      // Buys the last tickets\n      if (amount + totalRegistrationWithRole >= ownQuota.TicketsTotal) {\n        // Set event as sold out for this role in redis for 3 minutes\n        // to prevent unnecessary database locks & backend calculations\n        logger.info(\n          `Event ${eventId} is sold out for role ${strapiRoleUuid}. Setting sold out in redis for 3 minutes.`,\n        );\n        await redisClient.set(\n          `event-sold-out:${eventId}:${strapiRoleUuid}`,\n          'true',\n          'EX',\n          180, // 3 minutes\n        );\n\n        // Revalidates cache for event registrations so that the sold out status is updated\n        revalidateTag(`get-cached-event-registrations:${eventId}`);\n      }\n\n      const hasDefaultRole = localUser.roles.find(\n        (role) => role.role.strapiRoleUuid === options.noRoleId!,\n      );\n      if (!hasDefaultRole) {\n        // User should always have a default role\n        logger.error(\n          'User doesnt have a default role. This should never happen.',\n          localUser.entraUserUuid,\n        );\n        throw new Error(dictionary.api.server_error);\n      }\n\n      // Create event registrations. This is the actual reservation.\n      const eventRegistrationsFormatted = Array.from({ length: amount }).map(\n        () => ({\n          eventId,\n          entraUserUuid,\n          strapiRoleUuid,\n          price: ownQuota.Price,\n        }),\n      );\n\n      await prisma.eventRegistration.createMany({\n        data: eventRegistrationsFormatted,\n      });\n\n      logger.info(\n        `User ${\n          localUser.entraUserUuid\n        } reserved ${amount} tickets for event ${eventId}. User's total count of tickets for this event is now ${\n          currentUserReservations + amount\n        }`,\n      );\n\n      return {\n        message: dictionary.general.success,\n        isError: false,\n      };\n    })\n    .catch((error) => {\n      logger.error('Error creating reservation', error);\n      return {\n        message: dictionary.api.server_error,\n        isError: true,\n      };\n    });\n\n  if (result.isError) {\n    return result;\n  }\n\n  revalidateTag(`get-cached-user:${localUser.entraUserUuid}`);\n\n  return {\n    message: dictionary.general.success,\n    isError: false,\n  };\n}\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;;;;;;;;;;;AAEA,MAAM,UAAU;IACd,UAAU,QAAQ,GAAG,CAAC,sBAAsB;AAC9C;AAEO,eAAe,uCAAe,GAAf,kBACpB,OAAe,EACf,MAAc,EACd,IAAuB,EACvB,aAAqB,EACrB,wBAA4C;IAE5C,MAAM,aAAa,MAAM,CAAA,GAAA,mHAAA,CAAA,gBAAa,AAAD,EAAE;IACvC,MAAM,UAAU,MAAM,CAAA,GAAA,2GAAA,CAAA,OAAI,AAAD;IAEzB,IAAI,CAAC,SAAS,MAAM;QAClB,OAAO;YACL,SAAS,WAAW,GAAG,CAAC,YAAY;YACpC,SAAS;QACX;IACF;IAEA,uFAAuF;IACvF,yDAAyD;IACzD,IACE,4BACA,OAAO,6BAA6B,UACpC;QACA,qDAAqD;QACrD,MAAM,YAAY,MAAM,0HAAA,CAAA,cAAW,CAAC,GAAG,CACrC,CAAC,eAAe,EAAE,QAAQ,CAAC,EAAE,0BAA0B;QAEzD,IAAI,WAAW;YACb,8HAAA,CAAA,SAAM,CAAC,IAAI,CACT,CAAC,iBAAiB,EAAE,QAAQ,sBAAsB,EAAE,0BAA0B;YAEhF,OAAO;gBACL,SAAS,WAAW,GAAG,CAAC,QAAQ;gBAChC,SAAS;YACX;QACF;IACF;IAEA,IAAI,CAAC,UAAU,MAAM,WAAW,SAAS,GAAG;QAC1C,OAAO;YACL,SAAS,WAAW,GAAG,CAAC,cAAc;YACtC,SAAS;QACX;IACF;IAEA,IAAI,CAAC,WAAW,MAAM,YAAY,UAAU,GAAG;QAC7C,OAAO;YACL,SAAS,WAAW,GAAG,CAAC,aAAa;YACrC,SAAS;QACX;IACF;IAEA,MAAM,YAAY,CAAC,YAAY,EAAE,QAAQ,wEAAwE,CAAC;IAClH,MAAM,cAAc,MAAM,CAAA,GAAA,8IAAA,CAAA,gBAAa,AAAD,EACpC,MACA,WACA;QAAC,CAAC,MAAM,EAAE,SAAS;KAAC,EACpB;IAGF,IAAI,CAAC,aAAa;QAChB,OAAO;YACL,SAAS,WAAW,GAAG,CAAC,aAAa;YACrC,SAAS;QACX;IACF;IAEA,wCAAwC;IACxC,MAAM,YAAY,MAAM,2HAAA,CAAA,UAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QAC7C,OAAO;YACL,eAAe,QAAQ,IAAI,CAAC,aAAa;QAC3C;QACA,SAAS;YACP,OAAO;gBACL,QAAQ;oBACN,MAAM;wBACJ,QAAQ;4BACN,gBAAgB;wBAClB;oBACF;oBACA,WAAW;gBACb;gBACA,OAAO;oBACL,IAAI;wBAAC;4BAAE,WAAW;gCAAE,KAAK,IAAI;4BAAO;wBAAE;wBAAG;4BAAE,WAAW;wBAAK;qBAAE;gBAC/D;YACF;QACF;IACF;IAEA,IAAI,CAAC,WAAW;QACd,OAAO;YACL,SAAS,WAAW,GAAG,CAAC,YAAY;YACpC,SAAS;QACX;IACF;IAEA,MAAM,kBACJ,UAAU,KAAK,CAAC,GAAG,CAAC,CAAC,OAAS,KAAK,IAAI,CAAC,cAAc,KAAK,EAAE;IAC/D,MAAM,cAAc,YAAY,IAAI,CAAC,UAAU,CAAC,YAAY,EAAE;IAE9D,MAAM,wBACJ,aAAa,IAAI,CAAC,aAAe,CAAC;YAChC,gBAAgB,WAAW,IAAI,EAAE,MAAM,YAAY;YACnD,QAAQ,WAAW,MAAM;QAC3B,CAAC,MAAM,EAAE;IAEX,MAAM,uBAAuB,sBAAsB,IAAI,CACrD,CAAC,OAAS,KAAK,cAAc,KAAK,QAAQ,QAAQ;IAGpD,MAAM,eAAe,gBAAgB,MAAM,CACzC,CAAC,KAAK;QACJ,MAAM,aACJ,sBAAsB,IAAI,CACxB,CAAC,OAAS,KAAK,cAAc,KAAK,iBACjC,UAAU;QACf,OAAO,aAAa,IAAI,MAAM,GAC1B;YAAE;YAAgB,QAAQ;QAAW,IACrC;IACN,GACA;QACE,gBAAgB,QAAQ,QAAQ;QAChC,QAAQ,sBAAsB,UAAU;IAC1C;IAGF,0DAA0D;IAC1D,IAAI,aAAa,cAAc,KAAK,eAAe;QACjD,OAAO;YACL,SAAS,WAAW,GAAG,CAAC,YAAY;YACpC,SAAS;YACT,aAAa;QACf;IACF;IAEA,MAAM,WAAW,aAAa,KAC5B,CAAC,OACC,KAAK,IAAI,EAAE,MAAM,YAAY,WAAW,aAAa,cAAc;IAGvE,6DAA6D;IAC7D,IAAI,CAAC,UAAU;QACb,OAAO;YACL,SAAS,WAAW,GAAG,CAAC,YAAY;YACpC,SAAS;QACX;IACF;IAEA,+CAA+C;IAC/C,IAAI,IAAI,KAAK,SAAS,kBAAkB,IAAI,IAAI,QAAQ;QACtD,OAAO;YACL,SAAS,WAAW,GAAG,CAAC,mBAAmB;YAC3C,SAAS;QACX;IACF;IAEA,qCAAqC;IACrC,IAAI,IAAI,KAAK,SAAS,oBAAoB,IAAI,IAAI,QAAQ;QACxD,OAAO;YACL,SAAS,WAAW,GAAG,CAAC,qBAAqB;YAC7C,SAAS;QACX;IACF;IAEA,MAAM,iBAAiB,aAAa,cAAc;IAClD,MAAM,gBAAgB,UAAU,aAAa;IAE7C,MAAM,SAAS,MAAM,2HAAA,CAAA,UAAM,CACxB,YAAY,CAAC,OAAO;QACnB,MAAM,OAAO,WAAW,CAAC,uDAAuD,CAAC;QAEjF,MAAM,CAAC,oBAAoB,wBAAwB,GAAG,MAAM,QAAQ,GAAG,CAAC;YACtE,OAAO,iBAAiB,CAAC,QAAQ,CAAC;gBAChC,OAAO;oBACL;oBACA,WAAW;oBACX,IAAI;wBACF;4BAAE,eAAe;gCAAE,KAAK,IAAI;4BAAO;wBAAE;wBACrC;4BAAE,kBAAkB;wBAAK;wBACzB;4BACE,kBAAkB;4BAClB,UAAU;gCAAE,MAAM;oCAAE,QAAQ;gCAAU;4BAAE;wBAC1C;qBACD;gBACH;gBACA,QAAQ;oBACN,cAAc;wBACZ,QAAQ;4BACN,gBAAgB;wBAClB;oBACF;gBACF;YACF;YACA,OAAO,iBAAiB,CAAC,KAAK,CAAC;gBAC7B,OAAO;oBACL;oBACA,eAAe,UAAU,aAAa;oBACtC,cAAc;wBACZ,gBAAgB,aAAa,cAAc;oBAC7C;oBACA,WAAW;oBACX,IAAI;wBACF;4BAAE,eAAe;gCAAE,KAAK,IAAI;4BAAO;wBAAE;wBACrC;4BAAE,kBAAkB;wBAAK;wBACzB;4BACE,kBAAkB;4BAClB,UAAU;gCAAE,MAAM;oCAAE,QAAQ;gCAAU;4BAAE;wBAC1C;qBACD;gBACH;YACF;SACD;QAED,MAAM,4BAA4B,mBAAmB,MAAM,CACzD,CAAC,eACC,aAAa,YAAY,CAAC,cAAc,KACxC,aAAa,cAAc,EAC7B,MAAM;QAER,8DAA8D;QAC9D,IAAI,6BAA6B,SAAS,YAAY,EAAE;YACtD,OAAO;gBACL,SAAS,WAAW,GAAG,CAAC,QAAQ;gBAChC,SAAS;YACX;QACF;QAEA,MAAM,mBACJ,SAAS,YAAY,GAAG;QAC1B,MAAM,sBAAsB,SAAS,mBAAmB;QAExD,gFAAgF;QAChF,IAAI,2BAA2B,qBAAqB;YAClD,OAAO;gBACL,SAAS,WAAW,GAAG,CAAC,uBAAuB;gBAC/C,SAAS;YACX;QACF;QAEA,sEAAsE;QACtE,MAAM,mBACJ,SAAS,2BAA2B;QACtC,IAAI,CAAC,kBAAkB;YACrB,OAAO;gBACL,SAAS,WAAW,GAAG,CAAC,iBAAiB;gBACzC,SAAS;YACX;QACF;QAEA,yDAAyD;QACzD,MAAM,cAAc,UAAU;QAC9B,IAAI,CAAC,aAAa;YAChB,OAAO;gBACL,SAAS,WAAW,GAAG,CAAC,kBAAkB;gBAC1C,SAAS;YACX;QACF;QAEA,wBAAwB;QACxB,IAAI,SAAS,6BAA6B,SAAS,YAAY,EAAE;YAC/D,6DAA6D;YAC7D,+DAA+D;YAC/D,8HAAA,CAAA,SAAM,CAAC,IAAI,CACT,CAAC,MAAM,EAAE,QAAQ,sBAAsB,EAAE,eAAe,0CAA0C,CAAC;YAErG,MAAM,0HAAA,CAAA,cAAW,CAAC,GAAG,CACnB,CAAC,eAAe,EAAE,QAAQ,CAAC,EAAE,gBAAgB,EAC7C,QACA,MACA;YAGF,mFAAmF;YACnF,CAAA,GAAA,6HAAA,CAAA,gBAAa,AAAD,EAAE,CAAC,+BAA+B,EAAE,SAAS;QAC3D;QAEA,MAAM,iBAAiB,UAAU,KAAK,CAAC,IAAI,CACzC,CAAC,OAAS,KAAK,IAAI,CAAC,cAAc,KAAK,QAAQ,QAAQ;QAEzD,IAAI,CAAC,gBAAgB;YACnB,yCAAyC;YACzC,8HAAA,CAAA,SAAM,CAAC,KAAK,CACV,8DACA,UAAU,aAAa;YAEzB,MAAM,IAAI,MAAM,WAAW,GAAG,CAAC,YAAY;QAC7C;QAEA,8DAA8D;QAC9D,MAAM,8BAA8B,MAAM,IAAI,CAAC;YAAE,QAAQ;QAAO,GAAG,GAAG,CACpE,IAAM,CAAC;gBACL;gBACA;gBACA;gBACA,OAAO,SAAS,KAAK;YACvB,CAAC;QAGH,MAAM,OAAO,iBAAiB,CAAC,UAAU,CAAC;YACxC,MAAM;QACR;QAEA,8HAAA,CAAA,SAAM,CAAC,IAAI,CACT,CAAC,KAAK,EACJ,UAAU,aAAa,CACxB,UAAU,EAAE,OAAO,mBAAmB,EAAE,QAAQ,sDAAsD,EACrG,0BAA0B,QAC1B;QAGJ,OAAO;YACL,SAAS,WAAW,OAAO,CAAC,OAAO;YACnC,SAAS;QACX;IACF,GACC,KAAK,CAAC,CAAC;QACN,8HAAA,CAAA,SAAM,CAAC,KAAK,CAAC,8BAA8B;QAC3C,OAAO;YACL,SAAS,WAAW,GAAG,CAAC,YAAY;YACpC,SAAS;QACX;IACF;IAEF,IAAI,OAAO,OAAO,EAAE;QAClB,OAAO;IACT;IAEA,CAAA,GAAA,6HAAA,CAAA,gBAAa,AAAD,EAAE,CAAC,gBAAgB,EAAE,UAAU,aAAa,EAAE;IAE1D,OAAO;QACL,SAAS,WAAW,OAAO,CAAC,OAAO;QACnC,SAAS;IACX;AACF;;;IA7UsB;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 677, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 772, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hu/Downloads/Compressed/luuppi-next-main4/luuppi-next-main/next/src/components/SidePartners/SidePartners.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/SidePartners/SidePartners.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/SidePartners/SidePartners.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAgT,GAC7U,8EACA","debugId":null}},
    {"offset": {"line": 786, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hu/Downloads/Compressed/luuppi-next-main4/luuppi-next-main/next/src/components/SidePartners/SidePartners.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/SidePartners/SidePartners.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/SidePartners/SidePartners.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAA4R,GACzT,0DACA","debugId":null}},
    {"offset": {"line": 800, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 810, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hu/Downloads/Compressed/luuppi-next-main4/luuppi-next-main/next/src/libs/db/queries/get-cached-event-registrations.ts"],"sourcesContent":["'server-only';\nimport prisma from '@/libs/db/prisma';\nimport { unstable_cache } from 'next/cache';\n\nexport const getCachedEventRegistrations = (eventId: number) =>\n  unstable_cache(\n    async (eventId: number) => {\n      const res = await prisma.eventRegistration.findMany({\n        where: {\n          eventId,\n          deletedAt: null,\n          OR: [\n            {\n              reservedUntil: {\n                gte: new Date(),\n              },\n            },\n            {\n              paymentCompleted: true,\n            },\n            {\n              paymentCompleted: false,\n              payments: {\n                some: {\n                  status: 'PENDING',\n                },\n              },\n            },\n          ],\n        },\n        select: {\n          entraUserUuid: true,\n          paymentCompleted: true,\n          purchaseRole: {\n            select: {\n              strapiRoleUuid: true,\n            },\n          },\n        },\n      });\n\n      return res;\n    },\n    ['get-cached-event-registrations'],\n    {\n      revalidate: 60,\n      tags: [`get-cached-event-registrations:${eventId}`],\n    },\n  )(eventId);\n"],"names":[],"mappings":";;;AACA;AACA;AAFA;;;AAIO,MAAM,8BAA8B,CAAC,UAC1C,CAAA,GAAA,6HAAA,CAAA,iBAAc,AAAD,EACX,OAAO;QACL,MAAM,MAAM,MAAM,2HAAA,CAAA,UAAM,CAAC,iBAAiB,CAAC,QAAQ,CAAC;YAClD,OAAO;gBACL;gBACA,WAAW;gBACX,IAAI;oBACF;wBACE,eAAe;4BACb,KAAK,IAAI;wBACX;oBACF;oBACA;wBACE,kBAAkB;oBACpB;oBACA;wBACE,kBAAkB;wBAClB,UAAU;4BACR,MAAM;gCACJ,QAAQ;4BACV;wBACF;oBACF;iBACD;YACH;YACA,QAAQ;gBACN,eAAe;gBACf,kBAAkB;gBAClB,cAAc;oBACZ,QAAQ;wBACN,gBAAgB;oBAClB;gBACF;YACF;QACF;QAEA,OAAO;IACT,GACA;QAAC;KAAiC,EAClC;QACE,YAAY;QACZ,MAAM;YAAC,CAAC,+BAA+B,EAAE,SAAS;SAAC;IACrD,GACA","debugId":null}},
    {"offset": {"line": 867, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hu/Downloads/Compressed/luuppi-next-main4/luuppi-next-main/next/src/libs/db/queries/get-cached-user.ts"],"sourcesContent":["'server-only';\nimport prisma from '@/libs/db/prisma';\nimport { unstable_cache } from 'next/cache';\n\nexport const getCachedUser = (entraUserUuid: string) =>\n  unstable_cache(\n    async (entraUserUuid: string) => {\n      const res = await prisma.user.findFirst({\n        where: {\n          entraUserUuid,\n        },\n        select: {\n          entraUserUuid: true,\n          roles: {\n            include: {\n              role: true,\n            },\n            where: {\n              OR: [\n                {\n                  expiresAt: {\n                    gte: new Date(),\n                  },\n                },\n                {\n                  expiresAt: null,\n                },\n              ],\n            },\n          },\n          registrations: {\n            where: {\n              deletedAt: null,\n              OR: [\n                {\n                  paymentCompleted: true,\n                },\n                {\n                  reservedUntil: {\n                    gte: new Date(),\n                  },\n                },\n              ],\n            },\n          },\n        },\n      });\n\n      return res;\n    },\n    ['get-cached-user'],\n    {\n      revalidate: 60,\n      tags: [`get-cached-user:${entraUserUuid}`],\n    },\n  )(entraUserUuid);\n"],"names":[],"mappings":";;;AACA;AACA;AAFA;;;AAIO,MAAM,gBAAgB,CAAC,gBAC5B,CAAA,GAAA,6HAAA,CAAA,iBAAc,AAAD,EACX,OAAO;QACL,MAAM,MAAM,MAAM,2HAAA,CAAA,UAAM,CAAC,IAAI,CAAC,SAAS,CAAC;YACtC,OAAO;gBACL;YACF;YACA,QAAQ;gBACN,eAAe;gBACf,OAAO;oBACL,SAAS;wBACP,MAAM;oBACR;oBACA,OAAO;wBACL,IAAI;4BACF;gCACE,WAAW;oCACT,KAAK,IAAI;gCACX;4BACF;4BACA;gCACE,WAAW;4BACb;yBACD;oBACH;gBACF;gBACA,eAAe;oBACb,OAAO;wBACL,WAAW;wBACX,IAAI;4BACF;gCACE,kBAAkB;4BACpB;4BACA;gCACE,eAAe;oCACb,KAAK,IAAI;gCACX;4BACF;yBACD;oBACH;gBACF;YACF;QACF;QAEA,OAAO;IACT,GACA;QAAC;KAAkB,EACnB;QACE,YAAY;QACZ,MAAM;YAAC,CAAC,gBAAgB,EAAE,eAAe;SAAC;IAC5C,GACA","debugId":null}},
    {"offset": {"line": 931, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hu/Downloads/Compressed/luuppi-next-main4/luuppi-next-main/next/src/components/Ticket/Ticket.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/Ticket/Ticket.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/Ticket/Ticket.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAoS,GACjU,kEACA","debugId":null}},
    {"offset": {"line": 945, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hu/Downloads/Compressed/luuppi-next-main4/luuppi-next-main/next/src/components/Ticket/Ticket.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/Ticket/Ticket.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/Ticket/Ticket.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAgR,GAC7S,8CACA","debugId":null}},
    {"offset": {"line": 959, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 969, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hu/Downloads/Compressed/luuppi-next-main4/luuppi-next-main/next/src/components/Ticket/TicketArea.tsx"],"sourcesContent":["import { auth } from '@/auth';\nimport { getDictionary } from '@/dictionaries';\nimport { getCachedEventRegistrations } from '@/libs/db/queries/get-cached-event-registrations';\nimport { getCachedUser } from '@/libs/db/queries/get-cached-user';\nimport { SupportedLanguage } from '@/models/locale';\nimport { APIResponse } from '@/types/types';\nimport { BiErrorCircle } from 'react-icons/bi';\nimport { IoIosInformationCircleOutline } from 'react-icons/io';\nimport { IoWarningOutline } from 'react-icons/io5';\nimport Ticket from './Ticket';\n\ninterface TicketAreaProps {\n  lang: SupportedLanguage;\n  event: APIResponse<'api::event.event'>;\n}\n\nexport default async function TicketArea({ lang, event }: TicketAreaProps) {\n  const session = await auth();\n  const dictionary = await getDictionary(lang);\n\n  const ticketTypes = event.data.attributes.Registration?.TicketTypes;\n\n  const localUserPromise = session?.user?.entraUserUuid\n    ? getCachedUser(session.user.entraUserUuid)\n    : null;\n\n  const eventRegistrationsPromise = getCachedEventRegistrations(event.data.id);\n\n  const [localUser, eventRegistrations] = await Promise.all([\n    localUserPromise,\n    eventRegistrationsPromise,\n  ]);\n\n  const strapiRoleUuids =\n    localUser?.roles.map((role) => role.role.strapiRoleUuid) ?? [];\n  const eventRolesWithWeights =\n    ticketTypes?.map((ticketType) => ({\n      strapiRoleUuid: ticketType.Role?.data?.attributes?.RoleId,\n      weight: ticketType.Weight,\n    })) ?? [];\n\n  const hasDefaultRoleWeight = eventRolesWithWeights.find(\n    (role) => role.strapiRoleUuid === process.env.NEXT_PUBLIC_NO_ROLE_ID!,\n  );\n\n  const targetedRole = strapiRoleUuids.reduce(\n    (acc, strapiRoleUuid) => {\n      const roleWeight =\n        eventRolesWithWeights.find(\n          (role) => role.strapiRoleUuid === strapiRoleUuid,\n        )?.weight ?? 0;\n      return roleWeight > acc.weight\n        ? { strapiRoleUuid: strapiRoleUuid, weight: roleWeight }\n        : acc;\n    },\n    {\n      strapiRoleUuid: process.env.NEXT_PUBLIC_NO_ROLE_ID!,\n      weight: hasDefaultRoleWeight?.weight ?? 0,\n    },\n  );\n\n  const isOwnQuota = (role: string) => {\n    if (!session?.user) return false;\n    return targetedRole.strapiRoleUuid === role;\n  };\n\n  const isSoldOut = (total: number, roleUuid: string) => {\n    if (!eventRegistrations) return false;\n    const totalRegistrationWithRole = eventRegistrations.filter(\n      (registration) => registration.purchaseRole.strapiRoleUuid === roleUuid,\n    ).length;\n    return totalRegistrationWithRole >= total;\n  };\n\n  const isRegistrationOpen = (registrationEndsAt: Date) =>\n    new Date() < new Date(registrationEndsAt);\n\n  const hasBoughtMaxTickets = (roleUuid: string, maxAmount: number) => {\n    if (!eventRegistrations || !localUser) return false;\n    const userPurchases = localUser.registrations.filter(\n      (registration) => registration.eventId === event.data.id,\n    );\n    const userPurchasesWithRole = userPurchases.filter(\n      (registration) => registration.strapiRoleUuid === roleUuid,\n    );\n    return userPurchasesWithRole.length >= maxAmount;\n  };\n\n  const hasUnpaidReservations = (roleUuid: string) => {\n    if (!eventRegistrations || !localUser) return false;\n    const userPurchases = localUser.registrations.filter(\n      (registration) => registration.eventId === event.data.id,\n    );\n    const userPurchasesWithRole = userPurchases.filter(\n      (registration) => registration.strapiRoleUuid === roleUuid,\n    );\n    return userPurchasesWithRole.some(\n      (registration) => !registration.paymentCompleted,\n    );\n  };\n\n  const ownQuota = ticketTypes?.find(\n    (type) =>\n      type.Role?.data?.attributes?.RoleId === targetedRole.strapiRoleUuid,\n  );\n\n  const isSoldOutOwnQuota = ownQuota\n    ? isSoldOut(ownQuota.TicketsTotal, ownQuota.Role?.data?.attributes?.RoleId!)\n    : false;\n\n  const hasUnpaidReservationsOwnQuota = ownQuota\n    ? hasUnpaidReservations(ownQuota.Role?.data?.attributes?.RoleId!)\n    : false;\n\n  const hasBoughtMaxTicketsOwnQuota = ownQuota\n    ? hasBoughtMaxTickets(\n        ownQuota.Role?.data?.attributes?.RoleId!,\n        ownQuota.TicketsAllowedToBuy,\n      )\n    : false;\n\n  const isRegistrationOpenOwnQuota = ownQuota\n    ? isRegistrationOpen(new Date(ownQuota.RegistrationEndsAt))\n    : false;\n\n  const ticketTypesFormatted = ticketTypes\n    ?.filter((type) => Boolean(type.Role?.data?.attributes?.RoleId))\n    ?.map((ticketType) => ({\n      name: ticketType[lang === 'en' ? 'NameEn' : 'NameFi'],\n      location:\n        event.data.attributes[lang === 'en' ? 'LocationEn' : 'LocationFi'],\n      price: ticketType.Price,\n      role: ticketType.Role?.data?.attributes?.RoleId,\n      registrationStartsAt: new Date(ticketType.RegistrationStartsAt),\n      registrationEndsAt: new Date(ticketType.RegistrationEndsAt),\n      isOwnQuota: isOwnQuota(ticketType.Role?.data?.attributes?.RoleId!),\n      maxTicketsPerUser: ticketType.TicketsAllowedToBuy,\n    }))\n    .sort((a, b) =>\n      a.isOwnQuota === b.isOwnQuota ? 0 : a.isOwnQuota ? -1 : 1,\n    );\n\n  // Add configuration validation\n  const getConfigurationErrors = () => {\n    const errors: string[] = [];\n\n    // Check for missing roles\n    const quotasWithoutRoles = ticketTypes?.filter(\n      (type) => !type.Role?.data?.attributes?.RoleId,\n    );\n    if (quotasWithoutRoles?.length) {\n      errors.push(\n        `${quotasWithoutRoles.length} quota(s) missing role configuration`,\n      );\n    }\n\n    // Check for invalid registration dates\n    ticketTypes?.forEach((type) => {\n      const startsAt = new Date(type.RegistrationStartsAt);\n      const endsAt = new Date(type.RegistrationEndsAt);\n      if (startsAt >= endsAt) {\n        errors.push(\n          `Invalid registration dates for ${type[lang === 'en' ? 'NameEn' : 'NameFi']}: registration ends before it starts`,\n        );\n      }\n    });\n\n    // Check for duplicate roles\n    const roleIds = ticketTypes\n      ?.map((type) => type.Role?.data?.attributes?.RoleId)\n      .filter(Boolean);\n    const duplicateRoles = roleIds?.filter(\n      (id, index) => roleIds.indexOf(id) !== index,\n    );\n    if (duplicateRoles?.length) {\n      errors.push(\n        `Multiple quotas configured for same role(s): ${duplicateRoles.join(', ')}`,\n      );\n    }\n\n    // Check for duplicate weights\n    const weights = ticketTypes?.map((type) => type.Weight);\n    const duplicateWeights = weights?.filter(\n      (weight, index) => weights.indexOf(weight) !== index,\n    );\n    if (duplicateWeights?.length) {\n      errors.push(\n        `Multiple quotas have same weight(s): ${duplicateWeights.join(', ')}`,\n      );\n    }\n\n    // Check question edit deadline\n    const questionEditUntil =\n      event.data.attributes.Registration?.AllowQuestionEditUntil;\n    const registrationEndDates = ticketTypes?.map(\n      (type) => new Date(type.RegistrationEndsAt),\n    );\n    if (\n      questionEditUntil &&\n      registrationEndDates?.some((date) => new Date(questionEditUntil) < date)\n    ) {\n      errors.push('Question edit deadline is set before registration ends');\n    }\n\n    return errors;\n  };\n\n  const configErrors = getConfigurationErrors();\n\n  if (configErrors.length || !ticketTypesFormatted?.length) {\n    return (\n      <div className=\"alert rounded-lg bg-red-200 text-sm text-red-800\">\n        <BiErrorCircle size={24} />\n        <div className=\"flex flex-col\">\n          <span className=\"font-semibold\">\n            {configErrors.length > 0\n              ? 'Configuration Error(s)'\n              : dictionary.pages_events.no_tickets}\n          </span>\n          {configErrors.length > 0 && (\n            <ul className=\"ml-4 mt-1 list-disc\">\n              {configErrors.map((error, index) => (\n                <li key={index}>{error}</li>\n              ))}\n            </ul>\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  const getErrors = () => {\n    const errors = [];\n    if (!session?.user)\n      errors.push({\n        message: dictionary.pages_events.login_required,\n        level: 'error',\n      });\n    if (session?.user && !ownQuota) {\n      errors.push({\n        message: dictionary.pages_events.no_quota,\n        level: 'error',\n      });\n    }\n    if (isSoldOutOwnQuota && ownQuota)\n      errors.push({\n        message: dictionary.pages_events.sold_out_info,\n        level: 'warn',\n      });\n    if (hasBoughtMaxTicketsOwnQuota && ownQuota)\n      errors.push({\n        message: dictionary.pages_events.max_tickets_bought,\n        level: 'info',\n      });\n    if (!isRegistrationOpenOwnQuota && ownQuota)\n      errors.push({\n        message: dictionary.pages_events.registration_closed,\n        level: 'info',\n      });\n    if (hasUnpaidReservationsOwnQuota && ownQuota)\n      errors.push({\n        message: dictionary.pages_events.unpaid_reservations,\n        level: 'warn',\n      });\n    return errors;\n  };\n\n  const errors = getErrors();\n\n  return ticketTypesFormatted.length > 0 ? (\n    <>\n      {errors.map((error, i) => (\n        <div\n          key={error.message}\n          className={`alert rounded-lg text-sm ${\n            error.level === 'warn'\n              ? 'bg-yellow-200/50 text-yellow-800'\n              : error.level === 'info'\n                ? 'bg-blue-200 text-blue-800'\n                : 'bg-red-200 text-sm text-red-800'\n          } ${i === errors.length - 1 ? 'mb-8' : 'mb-4'}`}\n        >\n          {error.level === 'error' && <BiErrorCircle size={24} />}\n          {error.level === 'warn' && <IoWarningOutline size={24} />}\n          {error.level === 'info' && (\n            <IoIosInformationCircleOutline size={24} />\n          )}\n          {error.message}\n        </div>\n      ))}\n      <div className=\"flex flex-col gap-4\">\n        {ticketTypesFormatted?.map((ticket, index) => (\n          <Ticket\n            key={`${ticket.name}-${index}`}\n            dictionary={dictionary}\n            disabled={\n              !ticket.isOwnQuota ||\n              isSoldOutOwnQuota ||\n              hasBoughtMaxTicketsOwnQuota ||\n              !isRegistrationOpenOwnQuota\n            }\n            eventId={event.data.id}\n            eventStartsAt={new Date(event.data.attributes.StartDate)}\n            isOwnQuota={isOwnQuota(ticket.role!)}\n            lang={lang}\n            targetedRole={targetedRole.strapiRoleUuid}\n            ticket={ticket}\n          />\n        ))}\n      </div>\n    </>\n  ) : (\n    <div className=\"alert rounded-lg bg-blue-200 text-blue-800\">\n      <BiErrorCircle size={24} />\n      {dictionary.pages_events.no_tickets}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1249, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hu/Downloads/Compressed/luuppi-next-main4/luuppi-next-main/next/src/libs/strapi/blocks-converter.ts"],"sourcesContent":["import { BlocksContent } from '@strapi/blocks-react-renderer';\n\nexport function getPlainText(block: BlocksContent): string {\n  return block\n    .map((node) => {\n      switch (node.type) {\n        case 'heading':\n          return node.children.map((child) =>\n            child.type === 'text' ? child.text : child.url,\n          );\n        case 'code':\n          return node.children.map((child) =>\n            child.type === 'text' ? child.text : child.url,\n          );\n        case 'quote':\n          return node.children.map((child) =>\n            child.type === 'text' ? child.text : child.url,\n          );\n        case 'list':\n          return node.children\n            .map((child) => recursiveListRenderer(child))\n            .flatMap((x) => x);\n        case 'paragraph': {\n          return node.children.map((child) =>\n            child.type === 'text' ? child.text : child.url,\n          );\n        }\n        default:\n          return [];\n      }\n    })\n    .flatMap((x) => x)\n    .join(' ');\n}\n\nfunction recursiveListRenderer(node: any): string[] {\n  if (node.type === 'list-item') {\n    return node.children.map((child: any) =>\n      child.type === 'text' ? child.text : child.url,\n    );\n  }\n\n  return node.children.map((child: any) => recursiveListRenderer(child));\n}\n"],"names":[],"mappings":";;;AAEO,SAAS,aAAa,KAAoB;IAC/C,OAAO,MACJ,GAAG,CAAC,CAAC;QACJ,OAAQ,KAAK,IAAI;YACf,KAAK;gBACH,OAAO,KAAK,QAAQ,CAAC,GAAG,CAAC,CAAC,QACxB,MAAM,IAAI,KAAK,SAAS,MAAM,IAAI,GAAG,MAAM,GAAG;YAElD,KAAK;gBACH,OAAO,KAAK,QAAQ,CAAC,GAAG,CAAC,CAAC,QACxB,MAAM,IAAI,KAAK,SAAS,MAAM,IAAI,GAAG,MAAM,GAAG;YAElD,KAAK;gBACH,OAAO,KAAK,QAAQ,CAAC,GAAG,CAAC,CAAC,QACxB,MAAM,IAAI,KAAK,SAAS,MAAM,IAAI,GAAG,MAAM,GAAG;YAElD,KAAK;gBACH,OAAO,KAAK,QAAQ,CACjB,GAAG,CAAC,CAAC,QAAU,sBAAsB,QACrC,OAAO,CAAC,CAAC,IAAM;YACpB,KAAK;gBAAa;oBAChB,OAAO,KAAK,QAAQ,CAAC,GAAG,CAAC,CAAC,QACxB,MAAM,IAAI,KAAK,SAAS,MAAM,IAAI,GAAG,MAAM,GAAG;gBAElD;YACA;gBACE,OAAO,EAAE;QACb;IACF,GACC,OAAO,CAAC,CAAC,IAAM,GACf,IAAI,CAAC;AACV;AAEA,SAAS,sBAAsB,IAAS;IACtC,IAAI,KAAK,IAAI,KAAK,aAAa;QAC7B,OAAO,KAAK,QAAQ,CAAC,GAAG,CAAC,CAAC,QACxB,MAAM,IAAI,KAAK,SAAS,MAAM,IAAI,GAAG,MAAM,GAAG;IAElD;IAEA,OAAO,KAAK,QAAQ,CAAC,GAAG,CAAC,CAAC,QAAe,sBAAsB;AACjE","debugId":null}},
    {"offset": {"line": 1284, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hu/Downloads/Compressed/luuppi-next-main4/luuppi-next-main/next/src/libs/utils/first-letter-uppercase.ts"],"sourcesContent":["/**\n * Converts first letter of a string to uppercase. Useful for\n * finnish month names.\n * @param str string to be converted\n * @returns string with first letter in uppercase\n */\nexport const firstLetterToUpperCase = (str: string) =>\n  str.charAt(0).toUpperCase() + str.slice(1);\n"],"names":[],"mappings":"AAAA;;;;;CAKC;;;AACM,MAAM,yBAAyB,CAAC,MACrC,IAAI,MAAM,CAAC,GAAG,WAAW,KAAK,IAAI,KAAK,CAAC","debugId":null}},
    {"offset": {"line": 1299, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hu/Downloads/Compressed/luuppi-next-main4/luuppi-next-main/next/src/libs/utils/format-date-range.ts"],"sourcesContent":["import { SupportedLanguage } from '@/models/locale';\nimport { longDateFormat, shortDateFormat, shortTimeFormat } from '../constants';\nimport { firstLetterToUpperCase } from './first-letter-uppercase';\n\nexport const formatDateRangeLong = (\n  start: Date,\n  end: Date,\n  lang: SupportedLanguage,\n): string => {\n  const startUTC = new Date(\n    start.getTime() + start.getTimezoneOffset() * 60000,\n  );\n\n  const endUTC = new Date(end.getTime() + end.getTimezoneOffset() * 60000);\n\n  const isMultipleDays = startUTC.toDateString() !== endUTC.toDateString();\n\n  if (!isMultipleDays) {\n    if (start.toISOString() === end.toISOString()) {\n      return `${firstLetterToUpperCase(\n        new Intl.DateTimeFormat(lang, {\n          hour: 'numeric',\n          minute: 'numeric',\n          day: 'numeric',\n          month: 'short',\n          weekday: 'long',\n          timeZone: 'Europe/Helsinki',\n        }).format(start),\n      )}`;\n    }\n\n    return `${firstLetterToUpperCase(\n      start.toLocaleString(lang, longDateFormat),\n    )} - ${start.toLocaleString(lang, shortTimeFormat)}-${end.toLocaleString(lang, shortTimeFormat)}`;\n  }\n\n  return `${firstLetterToUpperCase(\n    start.toLocaleString(lang, shortDateFormat),\n  )} - ${firstLetterToUpperCase(end.toLocaleString(lang, shortDateFormat))}`;\n};\n\nexport const formatDateRangeShort = (\n  start: Date,\n  end: Date,\n  lang: SupportedLanguage,\n): string => {\n  const startUTC = new Date(\n    start.getTime() + start.getTimezoneOffset() * 60000,\n  );\n  const endUTC = new Date(end.getTime() + end.getTimezoneOffset() * 60000);\n  if (start.toISOString() === end.toISOString()) {\n    return `${new Intl.DateTimeFormat(lang, {\n      hour: 'numeric',\n      minute: 'numeric',\n      timeZone: 'Europe/Helsinki',\n    }).format(start)}`;\n  }\n  if (startUTC.toDateString() === endUTC.toDateString()) {\n    return `${new Intl.DateTimeFormat(lang, {\n      hour: 'numeric',\n      minute: 'numeric',\n      timeZone: 'Europe/Helsinki',\n    }).format(start)} - ${new Intl.DateTimeFormat(lang, {\n      hour: 'numeric',\n      minute: 'numeric',\n      timeZone: 'Europe/Helsinki',\n    }).format(end)}`;\n  } else {\n    return `${new Intl.DateTimeFormat(lang, {\n      month: 'numeric',\n      day: 'numeric',\n      hour: 'numeric',\n      minute: 'numeric',\n      timeZone: 'Europe/Helsinki',\n    }).format(start)} - ${new Intl.DateTimeFormat(lang, {\n      month: 'numeric',\n      day: 'numeric',\n      hour: 'numeric',\n      minute: 'numeric',\n      timeZone: 'Europe/Helsinki',\n    }).format(end)}`;\n  }\n};\n"],"names":[],"mappings":";;;;AACA;AAAA;AACA;;;AAEO,MAAM,sBAAsB,CACjC,OACA,KACA;IAEA,MAAM,WAAW,IAAI,KACnB,MAAM,OAAO,KAAK,MAAM,iBAAiB,KAAK;IAGhD,MAAM,SAAS,IAAI,KAAK,IAAI,OAAO,KAAK,IAAI,iBAAiB,KAAK;IAElE,MAAM,iBAAiB,SAAS,YAAY,OAAO,OAAO,YAAY;IAEtE,IAAI,CAAC,gBAAgB;QACnB,IAAI,MAAM,WAAW,OAAO,IAAI,WAAW,IAAI;YAC7C,OAAO,GAAG,CAAA,GAAA,oJAAA,CAAA,yBAAsB,AAAD,EAC7B,IAAI,KAAK,cAAc,CAAC,MAAM;gBAC5B,MAAM;gBACN,QAAQ;gBACR,KAAK;gBACL,OAAO;gBACP,SAAS;gBACT,UAAU;YACZ,GAAG,MAAM,CAAC,SACT;QACL;QAEA,OAAO,GAAG,CAAA,GAAA,oJAAA,CAAA,yBAAsB,AAAD,EAC7B,MAAM,cAAc,CAAC,MAAM,6IAAA,CAAA,iBAAc,GACzC,GAAG,EAAE,MAAM,cAAc,CAAC,MAAM,6IAAA,CAAA,kBAAe,EAAE,CAAC,EAAE,IAAI,cAAc,CAAC,MAAM,6IAAA,CAAA,kBAAe,GAAG;IACnG;IAEA,OAAO,GAAG,CAAA,GAAA,oJAAA,CAAA,yBAAsB,AAAD,EAC7B,MAAM,cAAc,CAAC,MAAM,6IAAA,CAAA,kBAAe,GAC1C,GAAG,EAAE,CAAA,GAAA,oJAAA,CAAA,yBAAsB,AAAD,EAAE,IAAI,cAAc,CAAC,MAAM,6IAAA,CAAA,kBAAe,IAAI;AAC5E;AAEO,MAAM,uBAAuB,CAClC,OACA,KACA;IAEA,MAAM,WAAW,IAAI,KACnB,MAAM,OAAO,KAAK,MAAM,iBAAiB,KAAK;IAEhD,MAAM,SAAS,IAAI,KAAK,IAAI,OAAO,KAAK,IAAI,iBAAiB,KAAK;IAClE,IAAI,MAAM,WAAW,OAAO,IAAI,WAAW,IAAI;QAC7C,OAAO,GAAG,IAAI,KAAK,cAAc,CAAC,MAAM;YACtC,MAAM;YACN,QAAQ;YACR,UAAU;QACZ,GAAG,MAAM,CAAC,QAAQ;IACpB;IACA,IAAI,SAAS,YAAY,OAAO,OAAO,YAAY,IAAI;QACrD,OAAO,GAAG,IAAI,KAAK,cAAc,CAAC,MAAM;YACtC,MAAM;YACN,QAAQ;YACR,UAAU;QACZ,GAAG,MAAM,CAAC,OAAO,GAAG,EAAE,IAAI,KAAK,cAAc,CAAC,MAAM;YAClD,MAAM;YACN,QAAQ;YACR,UAAU;QACZ,GAAG,MAAM,CAAC,MAAM;IAClB,OAAO;QACL,OAAO,GAAG,IAAI,KAAK,cAAc,CAAC,MAAM;YACtC,OAAO;YACP,KAAK;YACL,MAAM;YACN,QAAQ;YACR,UAAU;QACZ,GAAG,MAAM,CAAC,OAAO,GAAG,EAAE,IAAI,KAAK,cAAc,CAAC,MAAM;YAClD,OAAO;YACP,KAAK;YACL,MAAM;YACN,QAAQ;YACR,UAAU;QACZ,GAAG,MAAM,CAAC,MAAM;IAClB;AACF","debugId":null}},
    {"offset": {"line": 1369, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hu/Downloads/Compressed/luuppi-next-main4/luuppi-next-main/next/src/libs/utils/json-ld.ts"],"sourcesContent":["import { Dictionary, SupportedLanguage } from '@/models/locale';\nimport { APIResponse, APIResponseData } from '@/types/types';\nimport {\n  EducationalOrganization,\n  Event as EventSchema,\n  NewsArticle,\n  Person,\n  WithContext,\n} from 'schema-dts';\nimport { getPlainText } from '../strapi/blocks-converter';\nimport { getStrapiUrl } from '../strapi/get-strapi-url';\n\nexport const getOrganizationJsonLd = (dictionary: Dictionary) => {\n  const jsonLd: WithContext<EducationalOrganization> = {\n    '@context': 'https://schema.org',\n    '@type': 'EducationalOrganization',\n    name: 'Luuppi ry',\n    description: dictionary.pages_home.hero.description,\n    openingHours: 'Mo,Tu,We,Th 09:00-15:00',\n    foundingDate: '1969-01-01',\n    url: 'https://luuppi.fi',\n    keywords: 'Luuppi, Luuppi ry, Tampere, Tampereen yliopisto, Ainejrjest',\n    logo: 'https://luuppi.fi/logo.png',\n    address: {\n      '@type': 'PostalAddress',\n      postalCode: '33100',\n      streetAddress: 'Yliopistonkatu 58b',\n      addressCountry: 'FI',\n      addressLocality: 'Tampere',\n    },\n    vatID: 'FI05123472',\n    contactPoint: {\n      '@type': 'ContactPoint',\n      contactType: dictionary.navigation.board,\n      email: 'hallitus@luuppi.fi',\n      availableLanguage: ['Finnish', 'English'],\n    },\n    sameAs: [\n      'https://www.facebook.com/luuppiry',\n      'https://www.tiktok.com/@luuppiry',\n      'https://www.instagram.com/luuppiry/',\n      'https://www.linkedin.com/company/luuppi-ry',\n      'https://fi.wikipedia.org/wiki/Luuppi_(ainej%C3%A4rjest%C3%B6)',\n      'https://www.linkedin.com/company/luuppi-ry',\n    ],\n    hasMap:\n      'https://www.google.com/maps/d/viewer?mid=1udxC-9jUfnpF5-bZyxiT3SlEcPMRnAh9',\n  };\n\n  return jsonLd;\n};\n\nexport const getEventJsonLd = (\n  event: APIResponse<'api::event.event'>,\n  lang: SupportedLanguage,\n) => {\n  const description = getPlainText(\n    event.data.attributes[lang === 'en' ? 'DescriptionEn' : 'DescriptionFi'],\n  ).slice(0, 300);\n\n  const imageUrlLocalized =\n    lang === 'en' && event.data.attributes.ImageEn?.data?.attributes?.url\n      ? event.data.attributes.ImageEn?.data?.attributes?.url\n      : event.data.attributes.Image?.data?.attributes?.url;\n\n  const jsonLd: WithContext<EventSchema> = {\n    '@context': 'https://schema.org',\n    '@type': 'Event',\n    name: event.data.attributes[lang === 'en' ? 'NameEn' : 'NameFi'],\n    url: `https://luuppi.fi/${lang}/events/${event.data.id}`,\n    startDate: new Date(event.data.attributes.StartDate).toISOString(),\n    endDate: new Date(event.data.attributes.EndDate).toISOString(),\n    description: description.slice(0, 300),\n    image: imageUrlLocalized ? getStrapiUrl(imageUrlLocalized) : undefined,\n    location: {\n      '@type': 'Place',\n      name: event.data.attributes[lang === 'en' ? 'LocationEn' : 'LocationFi'],\n    },\n    eventStatus: 'https://schema.org/EventScheduled',\n    eventAttendanceMode: 'https://schema.org/OfflineEventAttendanceMode',\n    offers: event.data.attributes.Registration?.TicketTypes.map((ticket) => ({\n      '@type': 'Offer',\n      name: lang === 'en' ? ticket.NameEn : ticket.NameFi,\n      price: ticket.Price,\n      priceCurrency: 'EUR',\n      url: `https://luuppi.fi/${lang}/events/${event.data.id}`,\n      validFrom: new Date(event.data.attributes.StartDate).toISOString(),\n      seller: {\n        '@type': 'Organization',\n        name: 'Luuppi ry',\n        url: 'https://luuppi.fi',\n      },\n    })),\n    organizer: {\n      '@type': 'Organization',\n      name: 'Luuppi ry',\n      url: 'https://luuppi.fi',\n      logo: {\n        '@type': 'ImageObject',\n        url: 'https://luuppi.fi/logo.png',\n      },\n    },\n    inLanguage: {\n      '@type': 'Language',\n      name: lang === 'en' ? 'English' : 'Finnish',\n      alternateName: lang === 'en' ? 'en' : 'fi',\n    },\n  };\n\n  return jsonLd;\n};\n\nexport const getNewsJsonLd = (\n  news: APIResponseData<'api::news-single.news-single'>,\n  lang: SupportedLanguage,\n) => {\n  // eslint-disable-next-line no-console\n  const jsonLd: WithContext<NewsArticle> = {\n    '@context': 'https://schema.org',\n    '@type': 'NewsArticle',\n    headline: news.attributes.title,\n    description: news.attributes.description,\n    image: news.attributes.banner?.data?.attributes?.url\n      ? getStrapiUrl(news.attributes.banner.data.attributes.url)\n      : undefined,\n    datePublished: new Date(news.attributes.createdAt!).toISOString(),\n    dateModified: new Date(news.attributes.updatedAt!).toISOString(),\n    publisher: {\n      '@type': 'Organization',\n      name: 'Luuppi ry',\n      logo: {\n        '@type': 'ImageObject',\n        url: 'https://luuppi.fi/logo.png',\n      },\n    },\n    author: {\n      '@type': 'Person',\n      name: news.attributes.authorName,\n      image: news.attributes.authorImage?.data?.attributes?.url\n        ? getStrapiUrl(news.attributes.authorImage.data.attributes.url)\n        : undefined,\n    },\n    inLanguage: {\n      '@type': 'Language',\n      name: lang === 'en' ? 'English' : 'Finnish',\n      alternateName: lang === 'en' ? 'en' : 'fi',\n    },\n  };\n\n  return jsonLd;\n};\n\nexport const getBoardMemberJsonLd = (\n  member: APIResponseData<'api::board-member.board-member'>,\n) => {\n  const jsonLd: WithContext<Person> = {\n    '@context': 'https://schema.org',\n    '@type': 'Person',\n    name: member.attributes?.fullName,\n    email: member.attributes.boardRoles?.data.map(\n      (role: any) => role.attributes.email,\n    ),\n    image: member?.attributes?.image?.data?.attributes?.url\n      ? getStrapiUrl(member.attributes?.image.data.attributes.url)\n      : undefined,\n    jobTitle: member.attributes.boardRoles?.data?.map(\n      (role: any) => role.attributes.title,\n    ),\n    worksFor: {\n      '@type': 'Organization',\n      name: 'Luuppi ry',\n      url: 'https://luuppi.fi',\n    },\n  };\n\n  return jsonLd;\n};\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1520, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hu/Downloads/Compressed/luuppi-next-main4/luuppi-next-main/next/src/app/%5Blang%5D/%28content-pages%29/events/%5Bslug%5D/page.js"],"sourcesContent":["import SidePartners from '@/components/SidePartners/SidePartners';\nimport TicketArea from '@/components/Ticket/TicketArea';\nimport { getDictionary } from '@/dictionaries';\nimport { dateFormat } from '@/libs/constants';\nimport { getPlainText } from '@/libs/strapi/blocks-converter';\nimport { getStrapiData } from '@/libs/strapi/get-strapi-data';\nimport { getStrapiUrl } from '@/libs/strapi/get-strapi-url';\nimport { formatDateRangeLong } from '@/libs/utils/format-date-range';\nimport { getEventJsonLd } from '@/libs/utils/json-ld';\nimport Image from 'next/image';\nimport Script from 'next/script';\nimport { Suspense } from 'react';\nimport { IoCalendarOutline, IoLocationOutline } from 'react-icons/io5';\nimport { PiImageBroken } from 'react-icons/pi';\n\nexport default async function Event(props) {\n  const params = await props.params;\n  const dictionary = await getDictionary(params.lang);\n\n  const id = parseInt(params.slug, 10);\n  if (isNaN(id)) {\n    return <div>Etkinlik bulunamad</div>;\n  }\n\n  const url = `/api/events/${params.slug}?populate=Seo.twitter.twitterImage&populate=Seo.openGraph.openGraphImage&populate=Image&populate=Registration.TicketTypes.Role`;\n\n  const event = await getStrapiData(\n    params.lang,\n    url,\n    [`event-${params.slug}`],\n    true,\n  );\n\n  if (!event) {\n    return <div>Etkinlik bulunamad</div>;\n  }\n\n  const partnersData = await getStrapiData(\n    params.lang,\n    '/api/companies?populate=*',\n    ['company'],\n  );\n\n  if (!event || !partnersData) {\n    return <div>Etkinlik bulunamadi</div>;\n  }\n\n  const imageUrlLocalized =\n    params.lang === 'en' && event.data.attributes.ImageEn?.data?.attributes?.url\n      ? event.data.attributes.ImageEn?.data?.attributes?.url\n      : event.data.attributes.Image?.data?.attributes?.url;\n\n  const imageUrl = imageUrlLocalized ? getStrapiUrl(imageUrlLocalized) : null;\n\n  const hasRegistration =\n    event.data.attributes?.Registration?.TicketTypes?.length;\n\n  return (\n    <>\n      <Script\n        dangerouslySetInnerHTML={{\n          __html: JSON.stringify(getEventJsonLd(event, params.lang)),\n        }}\n        id=\"event-jsonld\"\n        type=\"application/ld+json\"\n      />\n      <div className=\"relative flex w-full gap-12\">\n        <div className=\"flex w-full flex-col\">\n          <div className=\"relative mb-12 h-64 rounded-lg bg-gradient-to-r from-secondary-400 to-primary-300 max-md:h-44\">\n            {imageUrl ? (\n              <Image\n                alt=\"Page banner image\"\n                className=\"rounded-lg object-cover\"\n                src={imageUrl}\n                fill\n              />\n            ) : (\n              <div className=\"flex h-full items-center justify-center\">\n                <PiImageBroken className=\"text-8xl text-white\" />\n              </div>\n            )}\n          </div>\n          <div className=\"relative flex flex-col gap-4\">\n            <h1 className=\"break-words\">\n              {\n                event.data.attributes[\n                  params.lang === 'en' ? 'NameEn' : 'NameFi'\n                ]\n              }\n            </h1>\n            <div className=\"flex flex-col opacity-40\">\n              <p className=\"text-sm\">\n                {dictionary.general.content_updated}:{' '}\n                {new Date(event.data.attributes.updatedAt).toLocaleString(\n                  params.lang,\n                  dateFormat,\n                )}\n              </p>\n            </div>\n            <div className=\"luuppi-pattern absolute -left-28 -top-28 -z-50 h-[401px] w-[601px] max-md:left-0 max-md:w-full\" />\n          </div>\n          <div className=\"mb-12 mt-4 flex gap-4 rounded-lg bg-background-50\">\n            <span className=\"w-1 shrink-0 rounded-l-lg bg-secondary-400\" />\n            <div className=\"flex max-w-full flex-col gap-2 rounded-lg py-4 pr-4 font-semibold max-sm:text-sm\">\n              <div className=\"flex items-center\">\n                <div className=\"mr-2 flex items-center justify-center rounded-full bg-primary-400 p-2 text-white\">\n                  <IoCalendarOutline className=\"shrink-0 text-2xl\" />\n                </div>\n                <p className=\"line-clamp-2\">\n                  {formatDateRangeLong(\n                    new Date(event.data.attributes.StartDate),\n                    new Date(event.data.attributes.EndDate),\n                    params.lang,\n                  )}\n                </p>\n              </div>\n              <div className=\"flex items-center\">\n                <div className=\"mr-2 flex items-center justify-center rounded-full bg-primary-400 p-2 text-white\">\n                  <IoLocationOutline className=\"shrink-0 text-2xl\" />\n                </div>\n                <p className=\"line-clamp-2\">\n                  {\n                    event.data.attributes[\n                      params.lang === 'en' ? 'LocationEn' : 'LocationFi'\n                    ]\n                  }\n                </p>\n              </div>\n            </div>\n          </div>\n          {hasRegistration && (\n            <div className=\"mb-12\">\n              <h2 className=\"mb-4 text-2xl font-bold\">\n                {dictionary.pages_events.tickets}\n              </h2>\n              <Suspense\n                fallback={\n                  <div className=\"flex flex-col gap-4\">\n                    <div className=\"skeleton h-24 w-full\" />\n                    <div className=\"skeleton h-24 w-full\" />\n                  </div>\n                }\n              >\n                <TicketArea event={event} lang={params.lang} />\n              </Suspense>\n              <Suspense\n                fallback={\n                  <div className=\"mt-6\">\n                    <div className=\"skeleton h-8 w-48\" />\n                  </div>\n                }\n              >\n                <ShowParticipants eventId={id} lang={params.lang} />\n              </Suspense>\n            </div>\n          )}\n          <div className=\"organization-page prose prose-custom max-w-full break-words decoration-secondary-400 transition-all duration-300 ease-in-out\">\n            <BlockRendererClient\n              content={\n                event.data.attributes[\n                  params.lang === 'en' ? 'DescriptionEn' : 'DescriptionFi'\n                ]\n              }\n            />\n          </div>\n        </div>\n        <div className=\"sticky top-36 h-full w-full max-w-80 max-lg:hidden\">\n          <div className=\"flex flex-col gap-4\">\n            <SidePartners\n              dictionary={dictionary}\n              partnersData={partnersData.data}\n            />\n          </div>\n        </div>\n      </div>\n    </>\n  );\n}\n\nexport async function generateMetadata(props) {\n  const params = await props.params;\n  const event = await getStrapiData(\n    params.lang,\n    `/api/events/${params.slug}?populate=Image`,\n    [`event-${params.slug}`],\n    true,\n  );\n\n  if (!event) return {};\n\n  const pathname = `/${params.lang}/events/${params.slug}`;\n\n  const description = getPlainText(\n    event.data.attributes[\n      params.lang === 'en' ? 'DescriptionEn' : 'DescriptionFi'\n    ],\n  );\n\n  const title =\n    event.data.attributes[params.lang === 'en' ? 'NameEn' : 'NameFi'];\n\n  const imageUrlLocalized =\n    params.lang === 'en' && event.data.attributes.ImageEn?.data?.attributes?.url\n      ? event.data.attributes.ImageEn?.data?.attributes?.url\n      : event.data.attributes.Image?.data?.attributes?.url;\n\n  const imageUrl = imageUrlLocalized\n    ? getStrapiUrl(imageUrlLocalized)\n    : undefined;\n\n  const descriptionCutted = description.length > 300;\n\n  return {\n    title: `${title} | Luuppi ry`,\n    description: description.slice(0, 300) + (descriptionCutted ? '...' : ''),\n    alternates: {\n      canonical: pathname,\n      languages: {\n        fi: `/fi${pathname.slice(3)}`,\n        en: `/en${pathname.slice(3)}`,\n      },\n    },\n    openGraph: {\n      title,\n      description: description.slice(0, 300) + (descriptionCutted ? '...' : ''),\n      url: pathname,\n      siteName: 'Luuppi ry',\n      images: imageUrl,\n    },\n    twitter: {\n      title,\n      description: description.slice(0, 300) + (descriptionCutted ? '...' : ''),\n      card: 'summary_large_image',\n      images: imageUrl,\n    },\n  };\n}\n\n// TODO: Remove when partial pre-rendering is available in Nextjs 15\n/*\nexport async function generateStaticParams() {\n  const url = '/api/events';\n\n  const data = await getStrapiData(\n    'fi',\n    url,\n    ['event'],\n    true\n  );\n\n  if (!data) return [];\n\n  const events = data.data\n    .filter((e) => e.id)\n    .map((event) => event.id.toString());\n\n  return events.map((eventId) => ({\n    slug: eventId,\n  }));\n}\n*/\n"],"names":[],"mappings":"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","debugId":null}}]
}